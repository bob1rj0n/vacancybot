"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.botPlugin = exports.bot = void 0;
const tslib_1 = require("tslib");
const fastify_plugin_1 = tslib_1.__importDefault(require("fastify-plugin"));
const mongoose_1 = tslib_1.__importDefault(require("mongoose"));
const telegraf_1 = require("telegraf");
const telegraf_session_mongodb_1 = require("telegraf-session-mongodb");
const config_1 = require("../../common/config");
const main_scene_1 = require("../snece/0.scenes/main.scene");
const age_scene_1 = require("../snece/1.scenes/age.scene");
const connect_scene_1 = require("../snece/1.scenes/connect.scene");
const goal_scene_1 = require("../snece/1.scenes/goal.scene");
const maxSum_scene_1 = require("../snece/1.scenes/maxSum.scene");
const minSum_scene_1 = require("../snece/1.scenes/minSum.scene");
const name_scene_1 = require("../snece/1.scenes/name.scene");
const place_scene_1 = require("../snece/1.scenes/place.scene");
const profession_scene_1 = require("../snece/1.scenes/profession.scene");
const technology_scene_1 = require("../snece/1.scenes/technology.scene");
const timeToCall_scene_1 = require("../snece/1.scenes/timeToCall.scene");
const send_vacansy_scene_1 = require("../snece/2.scenes/send.vacansy.scene");
const phone_scene_1 = require("../snece/register/phone.scene");
const chooseLanguage_scene_1 = require("../snece/register/chooseLanguage.scene");
const bot_start_1 = require("../servers/bot.start");
const chooseVacansy_scene_1 = require("../snece/0.scenes/chooseVacansy.scene");
const officeName_scene_1 = require("../snece/3.scenes/officeName.scene");
const minPrice_scene_1 = require("../snece/3.scenes/minPrice.scene");
const maxPrice_scene_1 = require("../snece/3.scenes/maxPrice.scene");
const technology_scene_2 = require("../snece/3.scenes/technology.scene");
const place_scene_2 = require("../snece/3.scenes/place.scene");
const timeToCall_scene_2 = require("../snece/3.scenes/timeToCall.scene");
const timeOfWork_scene_1 = require("../snece/3.scenes/timeOfWork.scene");
const responsible_scene_1 = require("../snece/3.scenes/responsible.scene");
const changeLanguage_scene_1 = require("../snece/0.scenes/changeLanguage.scene");
const price_scene_1 = require("../snece/1.scenes/price.scene");
const direction_scene_1 = require("../snece/1.scenes/direction.scene");
const direction_scene_2 = require("../snece/3.scenes/direction.scene");
const myVacancy_scene_1 = require("../snece/4.scenes/myVacancy.scene");
const privacy_scene_1 = require("../snece/0.scenes/privacy.scene");
const price_scene_2 = require("../snece/3.scenes/price.scene");
exports.bot = new telegraf_1.Telegraf(config_1.ENV.BOT_TOKEN);
const stages = new telegraf_1.Scenes.Stage([
    ///for register
    chooseLanguage_scene_1.chooseLanguageScene,
    phone_scene_1.phoneNumberScene,
    ///scenes
    main_scene_1.mainScene,
    name_scene_1.nameScene,
    age_scene_1.ageScene,
    technology_scene_1.technologyScene,
    place_scene_1.placeScene,
    connect_scene_1.connectScene,
    profession_scene_1.professionScene,
    minSum_scene_1.minSumScene,
    maxSum_scene_1.maxSumScene,
    timeToCall_scene_1.timeToCallScene,
    goal_scene_1.goalScene,
    send_vacansy_scene_1.sendToAdminScene,
    chooseVacansy_scene_1.chooseVacansyScene,
    direction_scene_1.directionScene,
    ///hodim kk
    officeName_scene_1.officeNameScene,
    minPrice_scene_1.minPriceScene,
    maxPrice_scene_1.maxPriceScene,
    technology_scene_2.technology2Scene,
    place_scene_2.place2Scene,
    timeToCall_scene_2.timeToCall2Scene,
    timeOfWork_scene_1.timeOfWorkScene,
    responsible_scene_1.responsibleScene,
    changeLanguage_scene_1.changeLanguageScene,
    price_scene_1.priceScene,
    direction_scene_2.direction2Scene,
    myVacancy_scene_1.myVacancyScene,
    privacy_scene_1.privacyScene,
    price_scene_2.price2Scene,
]);
stages.command('start', bot_start_1.botStart);
async function plugin(server, opt, done) {
    server.post("/" + config_1.ENV.BOT_TOKEN, (req, res) => res.reply({ root: true }));
    exports.bot.use((0, telegraf_session_mongodb_1.session)(mongoose_1.default.connection.db, { collectionName: "sessions", sessionName: "session" }));
    exports.bot.use(stages.middleware());
    await server.register(require("@fastify/middie"));
    await server.register(exports.bot.webhookCallback("/" + config_1.ENV.BOT_TOKEN));
    exports.bot.start(bot_start_1.botStart);
    exports.bot.launch();
    done();
}
exports.botPlugin = (0, fastify_plugin_1.default)(plugin);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm90LnBsdWdpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ib3QvcGx1Z2lucy9ib3QucGx1Z2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSw0RUFBZ0M7QUFDaEMsZ0VBQWdDO0FBQ2hDLHVDQUE2RDtBQUM3RCx1RUFBbUQ7QUFDbkQsZ0RBQTBDO0FBRzFDLDZEQUF5RDtBQUN6RCwyREFBdUQ7QUFDdkQsbUVBQStEO0FBQy9ELDZEQUF5RDtBQUN6RCxpRUFBNkQ7QUFDN0QsaUVBQTZEO0FBQzdELDZEQUF5RDtBQUN6RCwrREFBMkQ7QUFDM0QseUVBQXFFO0FBQ3JFLHlFQUFxRTtBQUNyRSx5RUFBcUU7QUFDckUsNkVBQXdFO0FBQ3hFLCtEQUFpRTtBQUNqRSxpRkFBNkU7QUFDN0Usb0RBQWdEO0FBQ2hELCtFQUEyRTtBQUMzRSx5RUFBcUU7QUFDckUscUVBQWlFO0FBQ2pFLHFFQUFpRTtBQUNqRSx5RUFBc0U7QUFDdEUsK0RBQTREO0FBQzVELHlFQUFzRTtBQUN0RSx5RUFBcUU7QUFDckUsMkVBQXVFO0FBQ3ZFLGlGQUE2RTtBQUM3RSwrREFBMkQ7QUFDM0QsdUVBQW1FO0FBQ25FLHVFQUFvRTtBQUNwRSx1RUFBbUU7QUFDbkUsbUVBQStEO0FBQy9ELCtEQUE0RDtBQVEvQyxRQUFBLEdBQUcsR0FBRyxJQUFJLG1CQUFRLENBQVksWUFBRyxDQUFDLFNBQVMsQ0FBQyxDQUFBO0FBRXpELE1BQU0sTUFBTSxHQUFHLElBQUksaUJBQU0sQ0FBQyxLQUFLLENBQVk7SUFDdkMsZUFBZTtJQUNmLDBDQUFtQjtJQUNuQiw4QkFBZ0I7SUFFaEIsU0FBUztJQUNULHNCQUFTO0lBQ1Qsc0JBQVM7SUFDVCxvQkFBUTtJQUNSLGtDQUFlO0lBQ2Ysd0JBQVU7SUFDViw0QkFBWTtJQUNaLGtDQUFlO0lBQ2YsMEJBQVc7SUFDWCwwQkFBVztJQUNYLGtDQUFlO0lBQ2Ysc0JBQVM7SUFDVCxxQ0FBZ0I7SUFDaEIsd0NBQWtCO0lBQ2xCLGdDQUFjO0lBRWQsV0FBVztJQUNYLGtDQUFlO0lBQ2YsOEJBQWE7SUFDYiw4QkFBYTtJQUNiLG1DQUFnQjtJQUNoQix5QkFBVztJQUNYLG1DQUFnQjtJQUNoQixrQ0FBZTtJQUNmLG9DQUFnQjtJQUNoQiwwQ0FBbUI7SUFDbkIsd0JBQVU7SUFDVixpQ0FBZTtJQUNmLGdDQUFjO0lBQ2QsNEJBQVk7SUFDWix5QkFBVztDQUNkLENBQUMsQ0FBQTtBQUVGLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLG9CQUFRLENBQUMsQ0FBQTtBQUVqQyxLQUFLLFVBQVUsTUFBTSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsSUFBSTtJQUNuQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDekUsV0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFBLGtDQUFPLEVBQUMsa0JBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLEVBQUUsY0FBYyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ2hHLFdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUE7SUFDNUIsTUFBTSxNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUE7SUFDakQsTUFBTSxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxHQUFHLFlBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFBO0lBQy9ELFdBQUcsQ0FBQyxLQUFLLENBQUMsb0JBQVEsQ0FBQyxDQUFDO0lBQ3BCLFdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtJQUNaLElBQUksRUFBRSxDQUFBO0FBQ1YsQ0FBQztBQUVZLFFBQUEsU0FBUyxHQUFHLElBQUEsd0JBQUUsRUFBQyxNQUFNLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcCBmcm9tIFwiZmFzdGlmeS1wbHVnaW5cIjtcclxuaW1wb3J0IG1vbmdvb3NlIGZyb20gXCJtb25nb29zZVwiO1xyXG5pbXBvcnQgeyBDb250ZXh0LCBTY2VuZXMsIFRlbGVncmFmLCBNYXJrdXAgfSBmcm9tIFwidGVsZWdyYWZcIjtcclxuaW1wb3J0IHsgc2Vzc2lvbiB9IGZyb20gXCJ0ZWxlZ3JhZi1zZXNzaW9uLW1vbmdvZGJcIjtcclxuaW1wb3J0IHsgRU5WIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9jb25maWdcIjtcclxuaW1wb3J0IHsgU2NlbmVOYW1lcyB9IGZyb20gXCIuLi8uLi9jb21tb24vY29uc3RhbnQvU2NlbmVOYW1lXCI7XHJcbmltcG9ydCB7IFVzZXJNb2RlbCB9IGZyb20gXCIuLi8uLi9jb21tb24vZGIvbW9kZWwvdXNlci5tb2RlbFwiO1xyXG5pbXBvcnQgeyBtYWluU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMC5zY2VuZXMvbWFpbi5zY2VuZVwiO1xyXG5pbXBvcnQgeyBhZ2VTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy9hZ2Uuc2NlbmVcIjtcclxuaW1wb3J0IHsgY29ubmVjdFNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzEuc2NlbmVzL2Nvbm5lY3Quc2NlbmVcIjtcclxuaW1wb3J0IHsgZ29hbFNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzEuc2NlbmVzL2dvYWwuc2NlbmVcIjtcclxuaW1wb3J0IHsgbWF4U3VtU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMS5zY2VuZXMvbWF4U3VtLnNjZW5lXCI7XHJcbmltcG9ydCB7IG1pblN1bVNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzEuc2NlbmVzL21pblN1bS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBuYW1lU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMS5zY2VuZXMvbmFtZS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBwbGFjZVNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzEuc2NlbmVzL3BsYWNlLnNjZW5lXCI7XHJcbmltcG9ydCB7IHByb2Zlc3Npb25TY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy9wcm9mZXNzaW9uLnNjZW5lXCI7XHJcbmltcG9ydCB7IHRlY2hub2xvZ3lTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy90ZWNobm9sb2d5LnNjZW5lXCI7XHJcbmltcG9ydCB7IHRpbWVUb0NhbGxTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy90aW1lVG9DYWxsLnNjZW5lXCI7XHJcbmltcG9ydCB7IHNlbmRUb0FkbWluU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMi5zY2VuZXMvc2VuZC52YWNhbnN5LnNjZW5lXCI7XHJcbmltcG9ydCB7IHBob25lTnVtYmVyU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvcmVnaXN0ZXIvcGhvbmUuc2NlbmVcIjtcclxuaW1wb3J0IHsgY2hvb3NlTGFuZ3VhZ2VTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS9yZWdpc3Rlci9jaG9vc2VMYW5ndWFnZS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBib3RTdGFydCB9IGZyb20gXCIuLi9zZXJ2ZXJzL2JvdC5zdGFydFwiO1xyXG5pbXBvcnQgeyBjaG9vc2VWYWNhbnN5U2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMC5zY2VuZXMvY2hvb3NlVmFjYW5zeS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBvZmZpY2VOYW1lU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMy5zY2VuZXMvb2ZmaWNlTmFtZS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBtaW5QcmljZVNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzMuc2NlbmVzL21pblByaWNlLnNjZW5lXCI7XHJcbmltcG9ydCB7IG1heFByaWNlU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMy5zY2VuZXMvbWF4UHJpY2Uuc2NlbmVcIjtcclxuaW1wb3J0IHsgdGVjaG5vbG9neTJTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8zLnNjZW5lcy90ZWNobm9sb2d5LnNjZW5lXCI7XHJcbmltcG9ydCB7IHBsYWNlMlNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzMuc2NlbmVzL3BsYWNlLnNjZW5lXCI7XHJcbmltcG9ydCB7IHRpbWVUb0NhbGwyU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMy5zY2VuZXMvdGltZVRvQ2FsbC5zY2VuZVwiO1xyXG5pbXBvcnQgeyB0aW1lT2ZXb3JrU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMy5zY2VuZXMvdGltZU9mV29yay5zY2VuZVwiO1xyXG5pbXBvcnQgeyByZXNwb25zaWJsZVNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzMuc2NlbmVzL3Jlc3BvbnNpYmxlLnNjZW5lXCI7XHJcbmltcG9ydCB7IGNoYW5nZUxhbmd1YWdlU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMC5zY2VuZXMvY2hhbmdlTGFuZ3VhZ2Uuc2NlbmVcIjtcclxuaW1wb3J0IHsgcHJpY2VTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy9wcmljZS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBkaXJlY3Rpb25TY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy9kaXJlY3Rpb24uc2NlbmVcIjtcclxuaW1wb3J0IHsgZGlyZWN0aW9uMlNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzMuc2NlbmVzL2RpcmVjdGlvbi5zY2VuZVwiO1xyXG5pbXBvcnQgeyBteVZhY2FuY3lTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS80LnNjZW5lcy9teVZhY2FuY3kuc2NlbmVcIjtcclxuaW1wb3J0IHsgcHJpdmFjeVNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzAuc2NlbmVzL3ByaXZhY3kuc2NlbmVcIjtcclxuaW1wb3J0IHsgcHJpY2UyU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMy5zY2VuZXMvcHJpY2Uuc2NlbmVcIjtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgTXlDb250ZXh0IGV4dGVuZHMgQ29udGV4dCB7XHJcbiAgICBzZXNzaW9uOiBhbnk7XHJcbiAgICBzY2VuZTogU2NlbmVzLlNjZW5lQ29udGV4dFNjZW5lPE15Q29udGV4dD47XHJcbiAgICBLYW1pbmE6IFwiRGFzdHVyY2hpXCJcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGJvdCA9IG5ldyBUZWxlZ3JhZjxNeUNvbnRleHQ+KEVOVi5CT1RfVE9LRU4pXHJcblxyXG5jb25zdCBzdGFnZXMgPSBuZXcgU2NlbmVzLlN0YWdlPE15Q29udGV4dD4oW1xyXG4gICAgLy8vZm9yIHJlZ2lzdGVyXHJcbiAgICBjaG9vc2VMYW5ndWFnZVNjZW5lLFxyXG4gICAgcGhvbmVOdW1iZXJTY2VuZSxcclxuXHJcbiAgICAvLy9zY2VuZXNcclxuICAgIG1haW5TY2VuZSxcclxuICAgIG5hbWVTY2VuZSxcclxuICAgIGFnZVNjZW5lLFxyXG4gICAgdGVjaG5vbG9neVNjZW5lLFxyXG4gICAgcGxhY2VTY2VuZSxcclxuICAgIGNvbm5lY3RTY2VuZSxcclxuICAgIHByb2Zlc3Npb25TY2VuZSxcclxuICAgIG1pblN1bVNjZW5lLFxyXG4gICAgbWF4U3VtU2NlbmUsXHJcbiAgICB0aW1lVG9DYWxsU2NlbmUsXHJcbiAgICBnb2FsU2NlbmUsXHJcbiAgICBzZW5kVG9BZG1pblNjZW5lLFxyXG4gICAgY2hvb3NlVmFjYW5zeVNjZW5lLFxyXG4gICAgZGlyZWN0aW9uU2NlbmUsXHJcblxyXG4gICAgLy8vaG9kaW0ga2tcclxuICAgIG9mZmljZU5hbWVTY2VuZSxcclxuICAgIG1pblByaWNlU2NlbmUsXHJcbiAgICBtYXhQcmljZVNjZW5lLFxyXG4gICAgdGVjaG5vbG9neTJTY2VuZSxcclxuICAgIHBsYWNlMlNjZW5lLFxyXG4gICAgdGltZVRvQ2FsbDJTY2VuZSxcclxuICAgIHRpbWVPZldvcmtTY2VuZSxcclxuICAgIHJlc3BvbnNpYmxlU2NlbmUsXHJcbiAgICBjaGFuZ2VMYW5ndWFnZVNjZW5lLFxyXG4gICAgcHJpY2VTY2VuZSxcclxuICAgIGRpcmVjdGlvbjJTY2VuZSxcclxuICAgIG15VmFjYW5jeVNjZW5lLFxyXG4gICAgcHJpdmFjeVNjZW5lLFxyXG4gICAgcHJpY2UyU2NlbmUsXHJcbl0pXHJcblxyXG5zdGFnZXMuY29tbWFuZCgnc3RhcnQnLCBib3RTdGFydClcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHBsdWdpbihzZXJ2ZXIsIG9wdCwgZG9uZSkge1xyXG4gICAgc2VydmVyLnBvc3QoXCIvXCIgKyBFTlYuQk9UX1RPS0VOLCAocmVxLCByZXMpID0+IHJlcy5yZXBseSh7IHJvb3Q6IHRydWUgfSkpXHJcbiAgICBib3QudXNlKHNlc3Npb24obW9uZ29vc2UuY29ubmVjdGlvbi5kYiwgeyBjb2xsZWN0aW9uTmFtZTogXCJzZXNzaW9uc1wiLCBzZXNzaW9uTmFtZTogXCJzZXNzaW9uXCIgfSkpXHJcbiAgICBib3QudXNlKHN0YWdlcy5taWRkbGV3YXJlKCkpXHJcbiAgICBhd2FpdCBzZXJ2ZXIucmVnaXN0ZXIocmVxdWlyZShcIkBmYXN0aWZ5L21pZGRpZVwiKSlcclxuICAgIGF3YWl0IHNlcnZlci5yZWdpc3Rlcihib3Qud2ViaG9va0NhbGxiYWNrKFwiL1wiICsgRU5WLkJPVF9UT0tFTikpXHJcbiAgICBib3Quc3RhcnQoYm90U3RhcnQpO1xyXG4gICAgYm90LmxhdW5jaCgpXHJcbiAgICBkb25lKClcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGJvdFBsdWdpbiA9IGZwKHBsdWdpbik7XHJcbiJdfQ==