"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.botPlugin = exports.bot = void 0;
const tslib_1 = require("tslib");
const fastify_plugin_1 = tslib_1.__importDefault(require("fastify-plugin"));
const mongoose_1 = tslib_1.__importDefault(require("mongoose"));
const telegraf_1 = require("telegraf");
const telegraf_session_mongodb_1 = require("telegraf-session-mongodb");
const config_1 = require("../../common/config");
const main_scene_1 = require("../snece/0.scenes/main.scene");
const age_scene_1 = require("../snece/1.scenes/age.scene");
const connect_scene_1 = require("../snece/1.scenes/connect.scene");
const goal_scene_1 = require("../snece/1.scenes/goal.scene");
const name_scene_1 = require("../snece/1.scenes/name.scene");
const place_scene_1 = require("../snece/1.scenes/place.scene");
const profession_scene_1 = require("../snece/1.scenes/profession.scene");
const technology_scene_1 = require("../snece/1.scenes/technology.scene");
const timeToCall_scene_1 = require("../snece/1.scenes/timeToCall.scene");
const send_vacansy_scene_1 = require("../snece/2.scenes/send.vacansy.scene");
const phone_scene_1 = require("../snece/register/phone.scene");
const chooseLanguage_scene_1 = require("../snece/register/chooseLanguage.scene");
const bot_start_1 = require("../servers/bot.start");
const chooseVacansy_scene_1 = require("../snece/0.scenes/chooseVacansy.scene");
const officeName_scene_1 = require("../snece/3.scenes/officeName.scene");
const technology_scene_2 = require("../snece/3.scenes/technology.scene");
const place_scene_2 = require("../snece/3.scenes/place.scene");
const timeToCall_scene_2 = require("../snece/3.scenes/timeToCall.scene");
const timeOfWork_scene_1 = require("../snece/3.scenes/timeOfWork.scene");
const responsible_scene_1 = require("../snece/3.scenes/responsible.scene");
const changeLanguage_scene_1 = require("../snece/0.scenes/changeLanguage.scene");
const price_scene_1 = require("../snece/1.scenes/price.scene");
const direction_scene_1 = require("../snece/1.scenes/direction.scene");
const direction_scene_2 = require("../snece/3.scenes/direction.scene");
const myVacancy_scene_1 = require("../snece/4.scenes/myVacancy.scene");
const privacy_scene_1 = require("../snece/0.scenes/privacy.scene");
const price_scene_2 = require("../snece/3.scenes/price.scene");
const link_scene_1 = require("../snece/3.scenes/link.scene");
const enterLink_scene_1 = require("../snece/3.scenes/enterLink.scene");
exports.bot = new telegraf_1.Telegraf(config_1.ENV.BOT_TOKEN);
const stages = new telegraf_1.Scenes.Stage([
    ///for register
    chooseLanguage_scene_1.chooseLanguageScene,
    phone_scene_1.phoneNumberScene,
    ///scenes
    main_scene_1.mainScene,
    name_scene_1.nameScene,
    age_scene_1.ageScene,
    technology_scene_1.technologyScene,
    place_scene_1.placeScene,
    connect_scene_1.connectScene,
    profession_scene_1.professionScene,
    timeToCall_scene_1.timeToCallScene,
    goal_scene_1.goalScene,
    send_vacansy_scene_1.sendToAdminScene,
    chooseVacansy_scene_1.chooseVacansyScene,
    direction_scene_1.directionScene,
    ///hodim kk
    officeName_scene_1.officeNameScene,
    technology_scene_2.technology2Scene,
    place_scene_2.place2Scene,
    timeToCall_scene_2.timeToCall2Scene,
    timeOfWork_scene_1.timeOfWorkScene,
    responsible_scene_1.responsibleScene,
    changeLanguage_scene_1.changeLanguageScene,
    price_scene_1.priceScene,
    direction_scene_2.direction2Scene,
    myVacancy_scene_1.myVacancyScene,
    privacy_scene_1.privacyScene,
    price_scene_2.price2Scene,
    link_scene_1.linkScene,
    enterLink_scene_1.enterLinkScene
]);
stages.command('start', bot_start_1.botStart);
async function plugin(server, opt, done) {
    server.post("/" + config_1.ENV.BOT_TOKEN, (req, res) => res.reply({ root: true }));
    exports.bot.use((0, telegraf_session_mongodb_1.session)(mongoose_1.default.connection.db, { collectionName: "sessions", sessionName: "session" }));
    exports.bot.use(stages.middleware());
    await server.register(require("@fastify/middie"));
    await server.register(exports.bot.webhookCallback("/" + config_1.ENV.BOT_TOKEN));
    exports.bot.start(bot_start_1.botStart);
    exports.bot.launch();
    done();
}
exports.botPlugin = (0, fastify_plugin_1.default)(plugin);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm90LnBsdWdpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ib3QvcGx1Z2lucy9ib3QucGx1Z2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSw0RUFBZ0M7QUFDaEMsZ0VBQWdDO0FBQ2hDLHVDQUE2RDtBQUM3RCx1RUFBbUQ7QUFDbkQsZ0RBQTBDO0FBRzFDLDZEQUF5RDtBQUN6RCwyREFBdUQ7QUFDdkQsbUVBQStEO0FBQy9ELDZEQUF5RDtBQUN6RCw2REFBeUQ7QUFDekQsK0RBQTJEO0FBQzNELHlFQUFxRTtBQUNyRSx5RUFBcUU7QUFDckUseUVBQXFFO0FBQ3JFLDZFQUF3RTtBQUN4RSwrREFBaUU7QUFDakUsaUZBQTZFO0FBQzdFLG9EQUFnRDtBQUNoRCwrRUFBMkU7QUFDM0UseUVBQXFFO0FBQ3JFLHlFQUFzRTtBQUN0RSwrREFBNEQ7QUFDNUQseUVBQXNFO0FBQ3RFLHlFQUFxRTtBQUNyRSwyRUFBdUU7QUFDdkUsaUZBQTZFO0FBQzdFLCtEQUEyRDtBQUMzRCx1RUFBbUU7QUFDbkUsdUVBQW9FO0FBQ3BFLHVFQUFtRTtBQUNuRSxtRUFBK0Q7QUFDL0QsK0RBQTREO0FBQzVELDZEQUF5RDtBQUN6RCx1RUFBbUU7QUFRdEQsUUFBQSxHQUFHLEdBQUcsSUFBSSxtQkFBUSxDQUFZLFlBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQTtBQUV6RCxNQUFNLE1BQU0sR0FBRyxJQUFJLGlCQUFNLENBQUMsS0FBSyxDQUFZO0lBQ3ZDLGVBQWU7SUFDZiwwQ0FBbUI7SUFDbkIsOEJBQWdCO0lBRWhCLFNBQVM7SUFDVCxzQkFBUztJQUNULHNCQUFTO0lBQ1Qsb0JBQVE7SUFDUixrQ0FBZTtJQUNmLHdCQUFVO0lBQ1YsNEJBQVk7SUFDWixrQ0FBZTtJQUNmLGtDQUFlO0lBQ2Ysc0JBQVM7SUFDVCxxQ0FBZ0I7SUFDaEIsd0NBQWtCO0lBQ2xCLGdDQUFjO0lBRWQsV0FBVztJQUNYLGtDQUFlO0lBQ2YsbUNBQWdCO0lBQ2hCLHlCQUFXO0lBQ1gsbUNBQWdCO0lBQ2hCLGtDQUFlO0lBQ2Ysb0NBQWdCO0lBQ2hCLDBDQUFtQjtJQUNuQix3QkFBVTtJQUNWLGlDQUFlO0lBQ2YsZ0NBQWM7SUFDZCw0QkFBWTtJQUNaLHlCQUFXO0lBQ1gsc0JBQVM7SUFDVCxnQ0FBYztDQUNqQixDQUFDLENBQUE7QUFFRixNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxvQkFBUSxDQUFDLENBQUE7QUFFakMsS0FBSyxVQUFVLE1BQU0sQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUk7SUFDbkMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsWUFBRyxDQUFDLFNBQVMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ3pFLFdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBQSxrQ0FBTyxFQUFDLGtCQUFRLENBQUMsVUFBVSxDQUFDLEVBQUUsRUFBRSxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUNoRyxXQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFBO0lBQzVCLE1BQU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFBO0lBQ2pELE1BQU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFHLENBQUMsZUFBZSxDQUFDLEdBQUcsR0FBRyxZQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTtJQUMvRCxXQUFHLENBQUMsS0FBSyxDQUFDLG9CQUFRLENBQUMsQ0FBQztJQUNwQixXQUFHLENBQUMsTUFBTSxFQUFFLENBQUE7SUFDWixJQUFJLEVBQUUsQ0FBQTtBQUNWLENBQUM7QUFFWSxRQUFBLFNBQVMsR0FBRyxJQUFBLHdCQUFFLEVBQUMsTUFBTSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnAgZnJvbSBcImZhc3RpZnktcGx1Z2luXCI7XHJcbmltcG9ydCBtb25nb29zZSBmcm9tIFwibW9uZ29vc2VcIjtcclxuaW1wb3J0IHsgQ29udGV4dCwgU2NlbmVzLCBUZWxlZ3JhZiwgTWFya3VwIH0gZnJvbSBcInRlbGVncmFmXCI7XHJcbmltcG9ydCB7IHNlc3Npb24gfSBmcm9tIFwidGVsZWdyYWYtc2Vzc2lvbi1tb25nb2RiXCI7XHJcbmltcG9ydCB7IEVOViB9IGZyb20gXCIuLi8uLi9jb21tb24vY29uZmlnXCI7XHJcbmltcG9ydCB7IFNjZW5lTmFtZXMgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2NvbnN0YW50L1NjZW5lTmFtZVwiO1xyXG5pbXBvcnQgeyBVc2VyTW9kZWwgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2RiL21vZGVsL3VzZXIubW9kZWxcIjtcclxuaW1wb3J0IHsgbWFpblNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzAuc2NlbmVzL21haW4uc2NlbmVcIjtcclxuaW1wb3J0IHsgYWdlU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMS5zY2VuZXMvYWdlLnNjZW5lXCI7XHJcbmltcG9ydCB7IGNvbm5lY3RTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy9jb25uZWN0LnNjZW5lXCI7XHJcbmltcG9ydCB7IGdvYWxTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy9nb2FsLnNjZW5lXCI7XHJcbmltcG9ydCB7IG5hbWVTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8xLnNjZW5lcy9uYW1lLnNjZW5lXCI7XHJcbmltcG9ydCB7IHBsYWNlU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMS5zY2VuZXMvcGxhY2Uuc2NlbmVcIjtcclxuaW1wb3J0IHsgcHJvZmVzc2lvblNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzEuc2NlbmVzL3Byb2Zlc3Npb24uc2NlbmVcIjtcclxuaW1wb3J0IHsgdGVjaG5vbG9neVNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzEuc2NlbmVzL3RlY2hub2xvZ3kuc2NlbmVcIjtcclxuaW1wb3J0IHsgdGltZVRvQ2FsbFNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzEuc2NlbmVzL3RpbWVUb0NhbGwuc2NlbmVcIjtcclxuaW1wb3J0IHsgc2VuZFRvQWRtaW5TY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8yLnNjZW5lcy9zZW5kLnZhY2Fuc3kuc2NlbmVcIjtcclxuaW1wb3J0IHsgcGhvbmVOdW1iZXJTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS9yZWdpc3Rlci9waG9uZS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBjaG9vc2VMYW5ndWFnZVNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlL3JlZ2lzdGVyL2Nob29zZUxhbmd1YWdlLnNjZW5lXCI7XHJcbmltcG9ydCB7IGJvdFN0YXJ0IH0gZnJvbSBcIi4uL3NlcnZlcnMvYm90LnN0YXJ0XCI7XHJcbmltcG9ydCB7IGNob29zZVZhY2Fuc3lTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8wLnNjZW5lcy9jaG9vc2VWYWNhbnN5LnNjZW5lXCI7XHJcbmltcG9ydCB7IG9mZmljZU5hbWVTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8zLnNjZW5lcy9vZmZpY2VOYW1lLnNjZW5lXCI7XHJcbmltcG9ydCB7IHRlY2hub2xvZ3kyU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMy5zY2VuZXMvdGVjaG5vbG9neS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBwbGFjZTJTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8zLnNjZW5lcy9wbGFjZS5zY2VuZVwiO1xyXG5pbXBvcnQgeyB0aW1lVG9DYWxsMlNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzMuc2NlbmVzL3RpbWVUb0NhbGwuc2NlbmVcIjtcclxuaW1wb3J0IHsgdGltZU9mV29ya1NjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzMuc2NlbmVzL3RpbWVPZldvcmsuc2NlbmVcIjtcclxuaW1wb3J0IHsgcmVzcG9uc2libGVTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8zLnNjZW5lcy9yZXNwb25zaWJsZS5zY2VuZVwiO1xyXG5pbXBvcnQgeyBjaGFuZ2VMYW5ndWFnZVNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzAuc2NlbmVzL2NoYW5nZUxhbmd1YWdlLnNjZW5lXCI7XHJcbmltcG9ydCB7IHByaWNlU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMS5zY2VuZXMvcHJpY2Uuc2NlbmVcIjtcclxuaW1wb3J0IHsgZGlyZWN0aW9uU2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvMS5zY2VuZXMvZGlyZWN0aW9uLnNjZW5lXCI7XHJcbmltcG9ydCB7IGRpcmVjdGlvbjJTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8zLnNjZW5lcy9kaXJlY3Rpb24uc2NlbmVcIjtcclxuaW1wb3J0IHsgbXlWYWNhbmN5U2NlbmUgfSBmcm9tIFwiLi4vc25lY2UvNC5zY2VuZXMvbXlWYWNhbmN5LnNjZW5lXCI7XHJcbmltcG9ydCB7IHByaXZhY3lTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8wLnNjZW5lcy9wcml2YWN5LnNjZW5lXCI7XHJcbmltcG9ydCB7IHByaWNlMlNjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzMuc2NlbmVzL3ByaWNlLnNjZW5lXCI7XHJcbmltcG9ydCB7IGxpbmtTY2VuZSB9IGZyb20gXCIuLi9zbmVjZS8zLnNjZW5lcy9saW5rLnNjZW5lXCI7XHJcbmltcG9ydCB7IGVudGVyTGlua1NjZW5lIH0gZnJvbSBcIi4uL3NuZWNlLzMuc2NlbmVzL2VudGVyTGluay5zY2VuZVwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBNeUNvbnRleHQgZXh0ZW5kcyBDb250ZXh0IHtcclxuICAgIHNlc3Npb246IGFueTtcclxuICAgIHNjZW5lOiBTY2VuZXMuU2NlbmVDb250ZXh0U2NlbmU8TXlDb250ZXh0PjtcclxuICAgIEthbWluYTogXCJEYXN0dXJjaGlcIlxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgYm90ID0gbmV3IFRlbGVncmFmPE15Q29udGV4dD4oRU5WLkJPVF9UT0tFTilcclxuXHJcbmNvbnN0IHN0YWdlcyA9IG5ldyBTY2VuZXMuU3RhZ2U8TXlDb250ZXh0PihbXHJcbiAgICAvLy9mb3IgcmVnaXN0ZXJcclxuICAgIGNob29zZUxhbmd1YWdlU2NlbmUsXHJcbiAgICBwaG9uZU51bWJlclNjZW5lLFxyXG5cclxuICAgIC8vL3NjZW5lc1xyXG4gICAgbWFpblNjZW5lLFxyXG4gICAgbmFtZVNjZW5lLFxyXG4gICAgYWdlU2NlbmUsXHJcbiAgICB0ZWNobm9sb2d5U2NlbmUsXHJcbiAgICBwbGFjZVNjZW5lLFxyXG4gICAgY29ubmVjdFNjZW5lLFxyXG4gICAgcHJvZmVzc2lvblNjZW5lLFxyXG4gICAgdGltZVRvQ2FsbFNjZW5lLFxyXG4gICAgZ29hbFNjZW5lLFxyXG4gICAgc2VuZFRvQWRtaW5TY2VuZSxcclxuICAgIGNob29zZVZhY2Fuc3lTY2VuZSxcclxuICAgIGRpcmVjdGlvblNjZW5lLFxyXG5cclxuICAgIC8vL2hvZGltIGtrXHJcbiAgICBvZmZpY2VOYW1lU2NlbmUsXHJcbiAgICB0ZWNobm9sb2d5MlNjZW5lLFxyXG4gICAgcGxhY2UyU2NlbmUsXHJcbiAgICB0aW1lVG9DYWxsMlNjZW5lLFxyXG4gICAgdGltZU9mV29ya1NjZW5lLFxyXG4gICAgcmVzcG9uc2libGVTY2VuZSxcclxuICAgIGNoYW5nZUxhbmd1YWdlU2NlbmUsXHJcbiAgICBwcmljZVNjZW5lLFxyXG4gICAgZGlyZWN0aW9uMlNjZW5lLFxyXG4gICAgbXlWYWNhbmN5U2NlbmUsXHJcbiAgICBwcml2YWN5U2NlbmUsXHJcbiAgICBwcmljZTJTY2VuZSxcclxuICAgIGxpbmtTY2VuZSxcclxuICAgIGVudGVyTGlua1NjZW5lXHJcbl0pXHJcblxyXG5zdGFnZXMuY29tbWFuZCgnc3RhcnQnLCBib3RTdGFydClcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHBsdWdpbihzZXJ2ZXIsIG9wdCwgZG9uZSkge1xyXG4gICAgc2VydmVyLnBvc3QoXCIvXCIgKyBFTlYuQk9UX1RPS0VOLCAocmVxLCByZXMpID0+IHJlcy5yZXBseSh7IHJvb3Q6IHRydWUgfSkpXHJcbiAgICBib3QudXNlKHNlc3Npb24obW9uZ29vc2UuY29ubmVjdGlvbi5kYiwgeyBjb2xsZWN0aW9uTmFtZTogXCJzZXNzaW9uc1wiLCBzZXNzaW9uTmFtZTogXCJzZXNzaW9uXCIgfSkpXHJcbiAgICBib3QudXNlKHN0YWdlcy5taWRkbGV3YXJlKCkpXHJcbiAgICBhd2FpdCBzZXJ2ZXIucmVnaXN0ZXIocmVxdWlyZShcIkBmYXN0aWZ5L21pZGRpZVwiKSlcclxuICAgIGF3YWl0IHNlcnZlci5yZWdpc3Rlcihib3Qud2ViaG9va0NhbGxiYWNrKFwiL1wiICsgRU5WLkJPVF9UT0tFTikpXHJcbiAgICBib3Quc3RhcnQoYm90U3RhcnQpO1xyXG4gICAgYm90LmxhdW5jaCgpXHJcbiAgICBkb25lKClcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGJvdFBsdWdpbiA9IGZwKHBsdWdpbik7XHJcbiJdfQ==