"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sendToAdminScene = void 0;
const telegraf_1 = require("telegraf");
const messages_1 = require("../../../common/constant/messages");
const SceneName_1 = require("../../../common/constant/SceneName");
const findHrVacansy_model_1 = require("../../../common/db/model/findHrVacansy.model");
const vacancy_model_1 = require("../../../common/db/model/vacancy.model");
const functions_1 = require("../../../common/service/functions");
const admin_bot_plugin_1 = require("../../plugins/admin.bot.plugin");
exports.sendToAdminScene = new telegraf_1.Scenes.BaseScene(SceneName_1.SceneNames.SEND_TO_ADMIN);
exports.sendToAdminScene.enter(async (ctx) => {
    const lang = ctx.session.language;
    let buttons = [];
    buttons.push([telegraf_1.Markup.button.callback("✅ Ha", "✅"), telegraf_1.Markup.button.callback("❌ Yo'q", "❌")]);
    await ctx.replyWithHTML(messages_1.Messages.CheckAndSendVacancy[lang], telegraf_1.Markup.removeKeyboard());
    let msg = await (0, functions_1.getVacancy)(ctx.session);
    ctx.session.msg = msg;
    const uMsg = await ctx.replyWithPhoto({ source: "./uploads/image.jpg" }, {
        caption: msg,
        parse_mode: "HTML",
        reply_markup: {
            inline_keyboard: buttons
        }
    });
    ctx.session.userMsgId = uMsg.message_id;
    ctx.session.img = "./uploads/image.jpg";
    console.log("send vacancy scene : ", ctx.session);
});
exports.sendToAdminScene.action(/✅/, async (ctx) => {
    await ctx.editMessageReplyMarkup({ inline_keyboard: [] });
    const lang = ctx.session.language;
    let buttons = [];
    buttons.push([telegraf_1.Markup.button.callback("✅ Ha", "✅"), telegraf_1.Markup.button.callback("❌ Yo'q", "❌")]);
    let vac;
    if (ctx.session.vacancyType == 'findWork') {
        let data = {
            userId: ctx.from.id,
            direction: ctx.session.direction,
            name: ctx.session.name,
            age: ctx.session.age,
            technology: ctx.session.technology,
            tgUsername: ctx.from.username,
            phone: ctx.session.phone,
            place: ctx.session.place,
            price: ctx.session.price,
            profession: ctx.session.profession,
            timeToCall: ctx.session.timeToCall,
            goal: ctx.session.goal,
            userMsgId: ctx.session.userMsgId,
            img: ctx.session.img,
            hashtegs: ctx.session.hashtegs,
            vacancyType: ctx.session.vacancyType
        };
        vac = await vacancy_model_1.VacancyModel.create(data);
    }
    if (ctx.session.vacancyType == 'findHr') {
        let data = {
            userId: ctx.from.id,
            direction: ctx.session.direction,
            officeName: ctx.session.officeName,
            technology: ctx.session.technology_2,
            responsible: ctx.session.responsible,
            place: ctx.session.place_2,
            price: ctx.session.price_2,
            tgUsername: ctx.from.username ? ctx.from.username : null,
            timeOfWork: ctx.session.timeOfWork,
            timeToCall: ctx.session.timeToCall_2,
            userMsgId: ctx.session.userMsgId,
            addition: ctx.session.addition,
            img: ctx.session.img,
            hashtegs: ctx.session.hashtegs,
            link: ctx.session.link,
            vacancyType: ctx.session.vacancyType,
        };
        vac = await findHrVacansy_model_1.FindHrVacansyModel.create(data);
    }
    const vacInAdmin = await admin_bot_plugin_1.bot_admin.telegram.sendPhoto(
    // 651985244,
    1661832397, {
        source: ctx.session.img
    }, {
        caption: `✅ Malumotlarni tasdiqlang\n${ctx.session.msg}`,
        parse_mode: "HTML",
        reply_markup: {
            inline_keyboard: buttons
        }
    });
    ctx.session.vacancyType == 'findWork'
        ? await vacancy_model_1.VacancyModel.updateOne({ _id: vac._id }, { messageId: vacInAdmin.message_id })
        : await findHrVacansy_model_1.FindHrVacansyModel.updateOne({ _id: vac._id }, { messageId: vacInAdmin.message_id });
    await ctx.replyWithHTML(messages_1.Messages.SendToAdmin[lang]);
    await ctx.scene.enter(SceneName_1.SceneNames.MAIN);
});
exports.sendToAdminScene.action(/❌/, async (ctx) => {
    await ctx.editMessageReplyMarkup({ inline_keyboard: [] });
    const lang = ctx.session.language;
    await ctx.replyWithHTML(messages_1.Messages.Canceled[lang]);
    await ctx.scene.enter(SceneName_1.SceneNames.MAIN);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VuZC52YWNhbnN5LnNjZW5lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2JvdC9zbmVjZS8yLnNjZW5lcy9zZW5kLnZhY2Fuc3kuc2NlbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdUNBQTBDO0FBQzFDLGdFQUE2RDtBQUM3RCxrRUFBZ0U7QUFDaEUsc0ZBQWtGO0FBQ2xGLDBFQUFzRTtBQUN0RSxpRUFBK0Q7QUFFL0QscUVBQTJEO0FBRTlDLFFBQUEsZ0JBQWdCLEdBQUcsSUFBSSxpQkFBTSxDQUFDLFNBQVMsQ0FBWSxzQkFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBRzFGLHdCQUFnQixDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEVBQUU7SUFDakMsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7SUFFbEMsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO0lBQ2pCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxpQkFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUFFLGlCQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTNGLE1BQU0sR0FBRyxDQUFDLGFBQWEsQ0FBQyxtQkFBUSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxFQUFFLGlCQUFNLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQztJQUNyRixJQUFJLEdBQUcsR0FBRyxNQUFNLElBQUEsc0JBQVUsRUFBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBRXRCLE1BQU0sSUFBSSxHQUFHLE1BQU0sR0FBRyxDQUFDLGNBQWMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxFQUNu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LEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxVQUFVLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDdEYsQ0FBQyxDQUFDLE1BQU0sd0NBQWtCLENBQUMsU0FBUyxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxVQUFVLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztJQUdqRyxNQUFNLEdBQUcsQ0FBQyxhQUFhLENBQUMsbUJBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNwRCxNQUFNLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLHNCQUFVLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDMUMsQ0FBQyxDQUFDLENBQUE7QUFFRix3QkFBZ0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsRUFBRTtJQUN2QyxNQUFNLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFBO0lBRXpELE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO0lBQ2xDLE1BQU0sR0FBRyxDQUFDLGFBQWEsQ0FBQyxtQkFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO0lBQ2hELE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsc0JBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUMxQyxDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1hcmt1cCwgU2NlbmVzIH0gZnJvbSBcInRlbGVncmFmXCI7XG5pbXBvcnQgeyBNZXNzYWdlcyB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vY29uc3RhbnQvbWVzc2FnZXNcIjtcbmltcG9ydCB7IFNjZW5lTmFtZXMgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2NvbnN0YW50L1NjZW5lTmFtZVwiO1xuaW1wb3J0IHsgRmluZEhyVmFjYW5zeU1vZGVsIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9kYi9tb2RlbC9maW5kSHJWYWNhbnN5Lm1vZGVsXCI7XG5pbXBvcnQgeyBWYWNhbmN5TW9kZWwgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2RiL21vZGVsL3ZhY2FuY3kubW9kZWxcIjtcbmltcG9ydCB7IGdldFZhY2FuY3kgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL3NlcnZpY2UvZnVuY3Rpb25zXCI7XG5pbXBvcnQgeyBib3QsIE15Q29udGV4dCB9IGZyb20gXCIuLi8uLi9wbHVnaW5zL2JvdC5wbHVnaW5cIjtcbmltcG9ydCB7IGJvdF9hZG1pbiB9IGZyb20gXCIuLi8uLi9wbHVnaW5zL2FkbWluLmJvdC5wbHVnaW5cIjtcblxuZXhwb3J0IGNvbnN0IHNlbmRUb0FkbWluU2NlbmUgPSBuZXcgU2NlbmVzLkJhc2VTY2VuZTxNeUNvbnRleHQ+KFNjZW5lTmFtZXMuU0VORF9UT19BRE1JTik7XG5cblxuc2VuZFRvQWRtaW5TY2VuZS5lbnRlcihhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3QgbGFuZyA9IGN0eC5zZXNzaW9uLmxhbmd1YWdlO1xuXG4gICAgbGV0IGJ1dHRvbnMgPSBbXTtcbiAgICBidXR0b25zLnB1c2goW01hcmt1cC5idXR0b24uY2FsbGJhY2soXCLinIUgSGFcIiwgXCLinIVcIiksIE1hcmt1cC5idXR0b24uY2FsbGJhY2soXCLinYwgWW8ncVwiLCBcIuKdjFwiKV0pO1xuXG4gICAgYXdhaXQgY3R4LnJlcGx5V2l0aEhUTUwoTWVzc2FnZXMuQ2hlY2tBbmRTZW5kVmFjYW5jeVtsYW5nXSwgTWFya3VwLnJlbW92ZUtleWJvYXJkKCkpO1xuICAgIGxldCBtc2cgPSBhd2FpdCBnZXRWYWNhbmN5KGN0eC5zZXNzaW9uKTtcbiAgICBjdHguc2Vzc2lvbi5tc2cgPSBtc2c7XG5cbiAgICBjb25zdCB1TXNnID0gYXdhaXQgY3R4LnJlcGx5V2l0aFBob3RvKHsgc291cmNlOiBcIi4vdXBsb2Fkcy9pbWFnZS5qcGdcIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBjYXB0aW9uOiBtc2csXG4gICAgICAgICAgICBwYXJzZV9tb2RlOiBcIkhUTUxcIixcbiAgICAgICAgICAgIHJlcGx5X21hcmt1cDoge1xuICAgICAgICAgICAgICAgIGlubGluZV9rZXlib2FyZDogYnV0dG9uc1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbiAgICBjdHguc2Vzc2lvbi51c2VyTXNnSWQgPSB1TXNnLm1lc3NhZ2VfaWQ7XG4gICAgY3R4LnNlc3Npb24uaW1nID0gXCIuL3VwbG9hZHMvaW1hZ2UuanBnXCI7XG4gICAgY29uc29sZS5sb2coXCJzZW5kIHZhY2FuY3kgc2NlbmUgOiBcIiwgY3R4LnNlc3Npb24pXG5cbn0pXG5cbnNlbmRUb0FkbWluU2NlbmUuYWN0aW9uKC/inIUvLCBhc3luYyAoY3R4KSA9PiB7XG4gICAgYXdhaXQgY3R4LmVkaXRNZXNzYWdlUmVwbHlNYXJrdXAoeyBpbmxpbmVfa2V5Ym9hcmQ6IFtdIH0pXG4gICAgY29uc3QgbGFuZyA9IGN0eC5zZXNzaW9uLmxhbmd1YWdlO1xuXG4gICAgbGV0IGJ1dHRvbnMgPSBbXTtcbiAgICBidXR0b25zLnB1c2goW01hcmt1cC5idXR0b24uY2FsbGJhY2soXCLinIUgSGFcIiwgXCLinIVcIiksIE1hcmt1cC5idXR0b24uY2FsbGJhY2soXCLinYwgWW8ncVwiLCBcIuKdjFwiKV0pO1xuXG4gICAgbGV0IHZhYztcbiAgICBpZiAoY3R4LnNlc3Npb24udmFjYW5jeVR5cGUgPT0gJ2ZpbmRXb3JrJykge1xuICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgIHVzZXJJZDogY3R4LmZyb20uaWQsXG4gICAgICAgICAgICBkaXJlY3Rpb246IGN0eC5zZXNzaW9uLmRpcmVjdGlvbixcbiAgICAgICAgICAgIG5hbWU6IGN0eC5zZXNzaW9uLm5hbWUsXG4gICAgICAgICAgICBhZ2U6IGN0eC5zZXNzaW9uLmFnZSxcbiAgICAgICAgICAgIHRlY2hub2xvZ3k6IGN0eC5zZXNzaW9uLnRlY2hub2xvZ3ksXG4gICAgICAgICAgICB0Z1VzZXJuYW1lOiBjdHguZnJvbS51c2VybmFtZSxcbiAgICAgICAgICAgIHBob25lOiBjdHguc2Vzc2lvbi5waG9uZSxcbiAgICAgICAgICAgIHBsYWNlOiBjdHguc2Vzc2lvbi5wbGFjZSxcbiAgICAgICAgICAgIHByaWNlOiBjdHguc2Vzc2lvbi5wcmljZSxcbiAgICAgICAgICAgIHByb2Zlc3Npb246IGN0eC5zZXNzaW9uLnByb2Zlc3Npb24sXG4gICAgICAgICAgICB0aW1lVG9DYWxsOiBjdHguc2Vzc2lvbi50aW1lVG9DYWxsLFxuICAgICAgICAgICAgZ29hbDogY3R4LnNlc3Npb24uZ29hbCxcbiAgICAgICAgICAgIHVzZXJNc2dJZDogY3R4LnNlc3Npb24udXNlck1zZ0lkLFxuICAgICAgICAgICAgaW1nOiBjdHguc2Vzc2lvbi5pbWcsXG4gICAgICAgICAgICBoYXNodGVnczogY3R4LnNlc3Npb24uaGFzaHRlZ3MsXG4gICAgICAgICAgICB2YWNhbmN5VHlwZTogY3R4LnNlc3Npb24udmFjYW5jeVR5cGVcbiAgICAgICAgfVxuICAgICAgICB2YWMgPSBhd2FpdCBWYWNhbmN5TW9kZWwuY3JlYXRlKGRhdGEpO1xuICAgIH1cbiAgICBpZiAoY3R4LnNlc3Npb24udmFjYW5jeVR5cGUgPT0gJ2ZpbmRIcicpIHtcbiAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgICB1c2VySWQ6IGN0eC5mcm9tLmlkLFxuICAgICAgICAgICAgZGlyZWN0aW9uOiBjdHguc2Vzc2lvbi5kaXJlY3Rpb24sXG4gICAgICAgICAgICBvZmZpY2VOYW1lOiBjdHguc2Vzc2lvbi5vZmZpY2VOYW1lLFxuICAgICAgICAgICAgdGVjaG5vbG9neTogY3R4LnNlc3Npb24udGVjaG5vbG9neV8yLFxuICAgICAgICAgICAgcmVzcG9uc2libGU6IGN0eC5zZXNzaW9uLnJlc3BvbnNpYmxlLFxuICAgICAgICAgICAgcGxhY2U6IGN0eC5zZXNzaW9uLnBsYWNlXzIsXG4gICAgICAgICAgICBwcmljZTogY3R4LnNlc3Npb24ucHJpY2VfMixcbiAgICAgICAgICAgIHRnVXNlcm5hbWU6IGN0eC5mcm9tLnVzZXJuYW1lID8gY3R4LmZyb20udXNlcm5hbWUgOiBudWxsLFxuICAgICAgICAgICAgdGltZU9mV29yazogY3R4LnNlc3Npb24udGltZU9mV29yayxcbiAgICAgICAgICAgIHRpbWVUb0NhbGw6IGN0eC5zZXNzaW9uLnRpbWVUb0NhbGxfMixcbiAgICAgICAgICAgIHVzZXJNc2dJZDogY3R4LnNlc3Npb24udXNlck1zZ0lkLFxuICAgICAgICAgICAgYWRkaXRpb246IGN0eC5zZXNzaW9uLmFkZGl0aW9uLFxuICAgICAgICAgICAgaW1nOiBjdHguc2Vzc2lvbi5pbWcsXG4gICAgICAgICAgICBoYXNodGVnczogY3R4LnNlc3Npb24uaGFzaHRlZ3MsXG4gICAgICAgICAgICBsaW5rOiBjdHguc2Vzc2lvbi5saW5rLFxuICAgICAgICAgICAgdmFjYW5jeVR5cGU6IGN0eC5zZXNzaW9uLnZhY2FuY3lUeXBlLFxuICAgICAgICB9XG4gICAgICAgIHZhYyA9IGF3YWl0IEZpbmRIclZhY2Fuc3lNb2RlbC5jcmVhdGUoZGF0YSk7XG4gICAgfVxuICAgIGNvbnN0IHZhY0luQWRtaW4gPSBhd2FpdCBib3RfYWRtaW4udGVsZWdyYW0uc2VuZFBob3RvKFxuICAgICAgICAvLyA2NTE5ODUyNDQsXG4gICAgICAgIDE2NjE4MzIzOTcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHNvdXJjZTogY3R4LnNlc3Npb24uaW1nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGNhcHRpb246IGDinIUgTWFsdW1vdGxhcm5pIHRhc2RpcWxhbmdcXG4ke2N0eC5zZXNzaW9uLm1zZ31gLFxuICAgICAgICAgICAgcGFyc2VfbW9kZTogXCJIVE1MXCIsXG4gICAgICAgICAgICByZXBseV9tYXJrdXA6IHtcbiAgICAgICAgICAgICAgICBpbmxpbmVfa2V5Ym9hcmQ6IGJ1dHRvbnNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG5cbiAgICBjdHguc2Vzc2lvbi52YWNhbmN5VHlwZSA9PSAnZmluZFdvcmsnXG4gICAgICAgID8gYXdhaXQgVmFjYW5jeU1vZGVsLnVwZGF0ZU9uZSh7IF9pZDogdmFjLl9pZCB9LCB7IG1lc3NhZ2VJZDogdmFjSW5BZG1pbi5tZXNzYWdlX2lkIH0pXG4gICAgICAgIDogYXdhaXQgRmluZEhyVmFjYW5zeU1vZGVsLnVwZGF0ZU9uZSh7IF9pZDogdmFjLl9pZCB9LCB7IG1lc3NhZ2VJZDogdmFjSW5BZG1pbi5tZXNzYWdlX2lkIH0pO1xuXG5cbiAgICBhd2FpdCBjdHgucmVwbHlXaXRoSFRNTChNZXNzYWdlcy5TZW5kVG9BZG1pbltsYW5nXSk7XG4gICAgYXdhaXQgY3R4LnNjZW5lLmVudGVyKFNjZW5lTmFtZXMuTUFJTilcbn0pXG5cbnNlbmRUb0FkbWluU2NlbmUuYWN0aW9uKC/inYwvLCBhc3luYyAoY3R4KSA9PiB7XG4gICAgYXdhaXQgY3R4LmVkaXRNZXNzYWdlUmVwbHlNYXJrdXAoeyBpbmxpbmVfa2V5Ym9hcmQ6IFtdIH0pXG5cbiAgICBjb25zdCBsYW5nID0gY3R4LnNlc3Npb24ubGFuZ3VhZ2U7XG4gICAgYXdhaXQgY3R4LnJlcGx5V2l0aEhUTUwoTWVzc2FnZXMuQ2FuY2VsZWRbbGFuZ10pXG4gICAgYXdhaXQgY3R4LnNjZW5lLmVudGVyKFNjZW5lTmFtZXMuTUFJTilcbn0pXG4iXX0=