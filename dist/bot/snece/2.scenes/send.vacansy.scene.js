"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sendToAdminScene = void 0;
const tslib_1 = require("tslib");
const telegraf_1 = require("telegraf");
const messages_1 = require("../../../common/constant/messages");
const SceneName_1 = require("../../../common/constant/SceneName");
const findHrVacansy_model_1 = require("../../../common/db/model/findHrVacansy.model");
const vacancy_model_1 = require("../../../common/db/model/vacancy.model");
const functions_1 = require("../../../common/service/functions");
const telegraph_node_1 = tslib_1.__importDefault(require("telegraph-node"));
const admin_bot_plugin_1 = require("../../plugins/admin.bot.plugin");
exports.sendToAdminScene = new telegraf_1.Scenes.BaseScene(SceneName_1.SceneNames.SEND_TO_ADMIN);
const ph = new telegraph_node_1.default();
exports.sendToAdminScene.enter(async (ctx) => {
    const lang = ctx.session.language;
    let buttons = [];
    buttons.push([telegraf_1.Markup.button.callback("‚úÖ Ha", "‚úÖ"), telegraf_1.Markup.button.callback("‚ùå Yo'q", "‚ùå")]);
    const img = await (0, functions_1.addTextOnImage)(ctx.session);
    await ctx.replyWithHTML(messages_1.Messages.CheckAndSendVacancy[lang]);
    let msg;
    if (ctx.session.vacancyType == "findWork") {
        msg = (`
Ish joyi kerak:

üë®‚Äçüíº Xodim: ${ctx.session.name}
üïë Yosh: ${ctx.session.age}
üë®‚Äçüíª <b>Yo'nalish: ${ctx.session.direction}</b>
üìö Texnologiya: ${ctx.session.technology}
üá∫üáø Telegram: @${ctx.from.username}
üìû Aloqa: ${ctx.session.connect}
üåê Hudud: ${ctx.session.place}
üí∞ Maosh: ${ctx.session.price}
üë®üèª‚Äçüíª Kasbi: ${ctx.session.profession}
üï∞ Murojaat qilish vaqti: ${ctx.session.timeToCall}
üîé Maqsad: ${ctx.session.goal}

¬© @${ctx.botInfo.username}
`);
    }
    if (ctx.session.vacancyType == "findHr") {
        msg = (`
Xodim kerak:

üè¢ Idora: ${ctx.session.officeName}
üë®‚Äçüíª <b>Yo'nalish: ${ctx.session.direction}</b>
üìö Texnologiya: ${ctx.session.technology_2}
üá∫üáø Telegram: @${ctx.from.username} 
üåê Hudud: ${ctx.session.place_2}
‚úçÔ∏è Mas'ul: ${ctx.session.responsible}
üï∞ Murojaat vaqti: ${ctx.session.timeToCall_2}
üï∞ Ish vaqti: ${ctx.session.timeOfWork}
üí∞ Maosh: ${ctx.session.price_2}

¬© @${ctx.botInfo.username}
        `);
    }
    ctx.session.msg = msg;
    const uMsg = await ctx.replyWithPhoto({ source: img }, {
        caption: msg,
        parse_mode: "HTML",
        reply_markup: {
            inline_keyboard: buttons
        }
    });
    ctx.session.userMsgId = uMsg.message_id;
    ctx.session.img = img;
    console.log("send vacancy scene : ", ctx.session);
});
exports.sendToAdminScene.action(/‚úÖ/, async (ctx) => {
    await ctx.editMessageReplyMarkup({ inline_keyboard: [] });
    const lang = ctx.session.language;
    let buttons = [];
    buttons.push([telegraf_1.Markup.button.callback("‚úÖ Ha", "‚úÖ"), telegraf_1.Markup.button.callback("‚ùå Yo'q", "‚ùå")]);
    let vac;
    if (ctx.session.vacancyType == 'findWork') {
        let data = {
            userId: ctx.from.id,
            direction: ctx.session.direction,
            name: ctx.session.name,
            age: ctx.session.age,
            technology: ctx.session.technology,
            tgUsername: ctx.from.username,
            phone: ctx.session.connect,
            place: ctx.session.place,
            // minSum: ctx.session.minSum,
            // maxSum: ctx.session.maxSum,
            price: ctx.session.price,
            profession: ctx.session.profession,
            timeToCall: ctx.session.timeToCall,
            goal: ctx.session.goal,
            userMsgId: ctx.session.userMsgId,
            img: ctx.session.img
        };
        vac = await vacancy_model_1.VacancyModel.create(data);
    }
    if (ctx.session.vacancyType == 'findHr') {
        let data = {
            userId: ctx.from.id,
            direction: ctx.session.direction,
            officeName: ctx.session.officeName,
            technology: ctx.session.technology_2,
            responsible: ctx.session.responsible,
            place: ctx.session.place_2,
            price: ctx.session.price_2,
            tgUsername: ctx.from.username ? ctx.from.username : null,
            timeOfWork: ctx.session.timeOfWork,
            timeToCall: ctx.session.timeToCall_2,
            // minPrice: ctx.session.minPrice,
            // maxPrice: ctx.session.maxPrice,
            userMsgId: ctx.session.userMsgId,
            addition: ctx.session.addition ? ctx.session.addition : null,
            img: ctx.session.img
        };
        vac = await findHrVacansy_model_1.FindHrVacansyModel.create(data);
    }
    const vacInAdmin = await admin_bot_plugin_1.bot_admin.telegram.sendPhoto(651985244, {
        source: ctx.session.img
    }, {
        caption: `‚úÖ Malumotlarni tasdiqlang\n${ctx.session.msg}`,
        parse_mode: "HTML",
        reply_markup: {
            inline_keyboard: buttons
        }
    });
    ctx.session.vacancyType == 'findWork'
        ? await vacancy_model_1.VacancyModel.updateOne({ _id: vac._id }, { messageId: vacInAdmin.message_id })
        : await findHrVacansy_model_1.FindHrVacansyModel.updateOne({ _id: vac._id }, { messageId: vacInAdmin.message_id });
    await ctx.replyWithHTML(messages_1.Messages.SendToAdmin[lang]);
    await ctx.scene.enter(SceneName_1.SceneNames.MAIN);
});
exports.sendToAdminScene.action(/‚ùå/, async (ctx) => {
    await ctx.editMessageReplyMarkup({ inline_keyboard: [] });
    const lang = ctx.session.language;
    await ctx.replyWithHTML(messages_1.Messages.Canceled[lang]);
    await ctx.scene.enter(SceneName_1.SceneNames.MAIN);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VuZC52YWNhbnN5LnNjZW5lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2JvdC9zbmVjZS8yLnNjZW5lcy9zZW5kLnZhY2Fuc3kuc2NlbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLHVDQUEwQztBQUMxQyxnRUFBNkQ7QUFDN0Qsa0VBQWdFO0FBQ2hFLHNGQUFrRjtBQUNsRiwwRUFBc0U7QUFDdEUsaUVBQWdGO0FBRWhGLDRFQUF1QztBQUN2QyxxRUFBMkQ7QUFFOUMsUUFBQSxnQkFBZ0IsR0FBRyxJQUFJLGlCQUFNLENBQUMsU0FBUyxDQUFZLHNCQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7QUFFMUYsTUFBTSxFQUFFLEdBQUcsSUFBSSx3QkFBUyxFQUFFLENBQUM7QUFFM0Isd0JBQWdCLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsRUFBRTtJQUNqQyxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztJQUVsQyxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7SUFDakIsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLGlCQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUUsaUJBQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFM0YsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFBLDBCQUFjLEVBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRTlDLE1BQU0sR0FBRyxDQUFDLGFBQWEsQ0FBQyxtQkFBUSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDNUQsSUFBSSxHQUFHLENBQUM7SUFDUixJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsV0FBVyxJQUFJLFVBQVUsRUFBRTtRQUN2QyxHQUFHLEdBQUcsQ0FBQzs7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QyxTQUFTLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBR2pHLE1BQU0sR0FBRyxDQUFDLGFBQWEsQ0FBQyxtQkFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3BELE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsc0JBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUMxQyxDQUFDLENBQUMsQ0FBQTtBQUVGLHdCQUFnQixDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxFQUFFO0lBQ3ZDLE1BQU0sR0FBRyxDQUFDLHNCQUFzQixDQUFDLEVBQUUsZUFBZSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFFekQsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7SUFDbEMsTUFBTSxHQUFHLENBQUMsYUFBYSxDQUFDLG1CQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7SUFDaEQsTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxzQkFBVSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQzFDLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWFya3VwLCBTY2VuZXMgfSBmcm9tIFwidGVsZWdyYWZcIjtcclxuaW1wb3J0IHsgTWVzc2FnZXMgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2NvbnN0YW50L21lc3NhZ2VzXCI7XHJcbmltcG9ydCB7IFNjZW5lTmFtZXMgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2NvbnN0YW50L1NjZW5lTmFtZVwiO1xyXG5pbXBvcnQgeyBGaW5kSHJWYWNhbnN5TW9kZWwgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2RiL21vZGVsL2ZpbmRIclZhY2Fuc3kubW9kZWxcIjtcclxuaW1wb3J0IHsgVmFjYW5jeU1vZGVsIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9kYi9tb2RlbC92YWNhbmN5Lm1vZGVsXCI7XHJcbmltcG9ydCB7IGFkZFRleHRPbkltYWdlLCBUZWxlZ3JhZkFwaSB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vc2VydmljZS9mdW5jdGlvbnNcIjtcclxuaW1wb3J0IHsgYm90LCBNeUNvbnRleHQgfSBmcm9tIFwiLi4vLi4vcGx1Z2lucy9ib3QucGx1Z2luXCI7XHJcbmltcG9ydCBUZWxlZ3JhcGggZnJvbSBcInRlbGVncmFwaC1ub2RlXCI7XHJcbmltcG9ydCB7IGJvdF9hZG1pbiB9IGZyb20gXCIuLi8uLi9wbHVnaW5zL2FkbWluLmJvdC5wbHVnaW5cIjtcclxuXHJcbmV4cG9ydCBjb25zdCBzZW5kVG9BZG1pblNjZW5lID0gbmV3IFNjZW5lcy5CYXNlU2NlbmU8TXlDb250ZXh0PihTY2VuZU5hbWVzLlNFTkRfVE9fQURNSU4pO1xyXG5cclxuY29uc3QgcGggPSBuZXcgVGVsZWdyYXBoKCk7XHJcblxyXG5zZW5kVG9BZG1pblNjZW5lLmVudGVyKGFzeW5jIChjdHgpID0+IHtcclxuICAgIGNvbnN0IGxhbmcgPSBjdHguc2Vzc2lvbi5sYW5ndWFnZTtcclxuXHJcbiAgICBsZXQgYnV0dG9ucyA9IFtdO1xyXG4gICAgYnV0dG9ucy5wdXNoKFtNYXJrdXAuYnV0dG9uLmNhbGxiYWNrKFwi4pyFIEhhXCIsIFwi4pyFXCIpLCBNYXJrdXAuYnV0dG9uLmNhbGxiYWNrKFwi4p2MIFlvJ3FcIiwgXCLinYxcIildKTtcclxuXHJcbiAgICBjb25zdCBpbWcgPSBhd2FpdCBhZGRUZXh0T25JbWFnZShjdHguc2Vzc2lvbik7XHJcblxyXG4gICAgYXdhaXQgY3R4LnJlcGx5V2l0aEhUTUwoTWVzc2FnZXMuQ2hlY2tBbmRTZW5kVmFjYW5jeVtsYW5nXSk7XHJcbiAgICBsZXQgbXNnO1xyXG4gICAgaWYgKGN0eC5zZXNzaW9uLnZhY2FuY3lUeXBlID09IFwiZmluZFdvcmtcIikge1xyXG4gICAgICAgIG1zZyA9IChgXHJcbklzaCBqb3lpIGtlcmFrOlxyXG5cclxu8J+RqOKAjfCfkrwgWG9kaW06ICR7Y3R4LnNlc3Npb24ubmFtZX1cclxu8J+VkSBZb3NoOiAke2N0eC5zZXNzaW9uLmFnZX1cclxu8J+RqOKAjfCfkrsgPGI+WW8nbmFsaXNoOiAke2N0eC5zZXNzaW9uLmRpcmVjdGlvbn08L2I+XHJcbvCfk5ogVGV4bm9sb2dpeWE6ICR7Y3R4LnNlc3Npb24udGVjaG5vbG9neX1cclxu8J+HuvCfh78gVGVsZWdyYW06IEAke2N0eC5mcm9tLnVzZXJuYW1lfVxyXG7wn5OeIEFsb3FhOiAke2N0eC5zZXNzaW9uLmNvbm5lY3R9XHJcbvCfjJAgSHVkdWQ6ICR7Y3R4LnNlc3Npb24ucGxhY2V9XHJcbvCfkrAgTWFvc2g6ICR7Y3R4LnNlc3Npb24ucHJpY2V9XHJcbvCfkajwn4+74oCN8J+SuyBLYXNiaTogJHtjdHguc2Vzc2lvbi5wcm9mZXNzaW9ufVxyXG7wn5WwIE11cm9qYWF0IHFpbGlzaCB2YXF0aTogJHtjdHguc2Vzc2lvbi50aW1lVG9DYWxsfVxyXG7wn5SOIE1hcXNhZDogJHtjdHguc2Vzc2lvbi5nb2FsfVxyXG5cclxuwqkgQCR7Y3R4LmJvdEluZm8udXNlcm5hbWV9XHJcbmApXHJcbiAgICB9XHJcbiAgICBpZiAoY3R4LnNlc3Npb24udmFjYW5jeVR5cGUgPT0gXCJmaW5kSHJcIikge1xyXG4gICAgICAgIG1zZyA9IChgXHJcblhvZGltIGtlcmFrOlxyXG5cclxu8J+PoiBJZG9yYTogJHtjdHguc2Vzc2lvbi5vZmZpY2VOYW1lfVxyXG7wn5Go4oCN8J+SuyA8Yj5ZbyduYWxpc2g6ICR7Y3R4LnNlc3Npb24uZGlyZWN0aW9ufTwvYj5cclxu8J+TmiBUZXhub2xvZ2l5YTogJHtjdHguc2Vzc2lvbi50ZWNobm9sb2d5XzJ9XHJcbvCfh7rwn4e/IFRlbGVncmFtOiBAJHtjdHguZnJvbS51c2VybmFtZX0gXHJcbvCfjJAgSHVkdWQ6ICR7Y3R4LnNlc3Npb24ucGxhY2VfMn1cclxu4pyN77iPIE1hcyd1bDogJHtjdHguc2Vzc2lvbi5yZXNwb25zaWJsZX1cclxu8J+VsCBNdXJvamFhdCB2YXF0aTogJHtjdHguc2Vzc2lvbi50aW1lVG9DYWxsXzJ9XHJcbvCflbAgSXNoIHZhcXRpOiAke2N0eC5zZXNzaW9uLnRpbWVPZldvcmt9XHJcbvCfkrAgTWFvc2g6ICR7Y3R4LnNlc3Npb24ucHJpY2VfMn1cclxuXHJcbsKpIEAke2N0eC5ib3RJbmZvLnVzZXJuYW1lfVxyXG4gICAgICAgIGApXHJcbiAgICB9XHJcbiAgICBjdHguc2Vzc2lvbi5tc2cgPSBtc2c7XHJcblxyXG4gICAgY29uc3QgdU1zZyA9IGF3YWl0IGN0eC5yZXBseVdpdGhQaG90byh7IHNvdXJjZTogaW1nIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjYXB0aW9uOiBtc2csXHJcbiAgICAgICAgICAgIHBhcnNlX21vZGU6IFwiSFRNTFwiLFxyXG4gICAgICAgICAgICByZXBseV9tYXJrdXA6IHtcclxuICAgICAgICAgICAgICAgIGlubGluZV9rZXlib2FyZDogYnV0dG9uc1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgKTtcclxuICAgIGN0eC5zZXNzaW9uLnVzZXJNc2dJZCA9IHVNc2cubWVzc2FnZV9pZDtcclxuICAgIGN0eC5zZXNzaW9uLmltZyA9IGltZztcclxuICAgIGNvbnNvbGUubG9nKFwic2VuZCB2YWNhbmN5IHNjZW5lIDogXCIsIGN0eC5zZXNzaW9uKVxyXG5cclxufSlcclxuXHJcbnNlbmRUb0FkbWluU2NlbmUuYWN0aW9uKC/inIUvLCBhc3luYyAoY3R4KSA9PiB7XHJcbiAgICBhd2FpdCBjdHguZWRpdE1lc3NhZ2VSZXBseU1hcmt1cCh7IGlubGluZV9rZXlib2FyZDogW10gfSlcclxuICAgIGNvbnN0IGxhbmcgPSBjdHguc2Vzc2lvbi5sYW5ndWFnZTtcclxuXHJcbiAgICBsZXQgYnV0dG9ucyA9IFtdO1xyXG4gICAgYnV0dG9ucy5wdXNoKFtNYXJrdXAuYnV0dG9uLmNhbGxiYWNrKFwi4pyFIEhhXCIsIFwi4pyFXCIpLCBNYXJrdXAuYnV0dG9uLmNhbGxiYWNrKFwi4p2MIFlvJ3FcIiwgXCLinYxcIildKTtcclxuXHJcbiAgICBsZXQgdmFjO1xyXG4gICAgaWYgKGN0eC5zZXNzaW9uLnZhY2FuY3lUeXBlID09ICdmaW5kV29yaycpIHtcclxuICAgICAgICBsZXQgZGF0YSA9IHtcclxuICAgICAgICAgICAgdXNlcklkOiBjdHguZnJvbS5pZCxcclxuICAgICAgICAgICAgZGlyZWN0aW9uOiBjdHguc2Vzc2lvbi5kaXJlY3Rpb24sXHJcbiAgICAgICAgICAgIG5hbWU6IGN0eC5zZXNzaW9uLm5hbWUsXHJcbiAgICAgICAgICAgIGFnZTogY3R4LnNlc3Npb24uYWdlLFxyXG4gICAgICAgICAgICB0ZWNobm9sb2d5OiBjdHguc2Vzc2lvbi50ZWNobm9sb2d5LFxyXG4gICAgICAgICAgICB0Z1VzZXJuYW1lOiBjdHguZnJvbS51c2VybmFtZSxcclxuICAgICAgICAgICAgcGhvbmU6IGN0eC5zZXNzaW9uLmNvbm5lY3QsXHJcbiAgICAgICAgICAgIHBsYWNlOiBjdHguc2Vzc2lvbi5wbGFjZSxcclxuICAgICAgICAgICAgLy8gbWluU3VtOiBjdHguc2Vzc2lvbi5taW5TdW0sXHJcbiAgICAgICAgICAgIC8vIG1heFN1bTogY3R4LnNlc3Npb24ubWF4U3VtLFxyXG4gICAgICAgICAgICBwcmljZTogY3R4LnNlc3Npb24ucHJpY2UsXHJcbiAgICAgICAgICAgIHByb2Zlc3Npb246IGN0eC5zZXNzaW9uLnByb2Zlc3Npb24sXHJcbiAgICAgICAgICAgIHRpbWVUb0NhbGw6IGN0eC5zZXNzaW9uLnRpbWVUb0NhbGwsXHJcbiAgICAgICAgICAgIGdvYWw6IGN0eC5zZXNzaW9uLmdvYWwsXHJcbiAgICAgICAgICAgIHVzZXJNc2dJZDogY3R4LnNlc3Npb24udXNlck1zZ0lkLFxyXG4gICAgICAgICAgICBpbWc6IGN0eC5zZXNzaW9uLmltZ1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YWMgPSBhd2FpdCBWYWNhbmN5TW9kZWwuY3JlYXRlKGRhdGEpO1xyXG4gICAgfVxyXG4gICAgaWYgKGN0eC5zZXNzaW9uLnZhY2FuY3lUeXBlID09ICdmaW5kSHInKSB7XHJcbiAgICAgICAgbGV0IGRhdGEgPSB7XHJcbiAgICAgICAgICAgIHVzZXJJZDogY3R4LmZyb20uaWQsXHJcbiAgICAgICAgICAgIGRpcmVjdGlvbjogY3R4LnNlc3Npb24uZGlyZWN0aW9uLFxyXG4gICAgICAgICAgICBvZmZpY2VOYW1lOiBjdHguc2Vzc2lvbi5vZmZpY2VOYW1lLFxyXG4gICAgICAgICAgICB0ZWNobm9sb2d5OiBjdHguc2Vzc2lvbi50ZWNobm9sb2d5XzIsXHJcbiAgICAgICAgICAgIHJlc3BvbnNpYmxlOiBjdHguc2Vzc2lvbi5yZXNwb25zaWJsZSxcclxuICAgICAgICAgICAgcGxhY2U6IGN0eC5zZXNzaW9uLnBsYWNlXzIsXHJcbiAgICAgICAgICAgIHByaWNlOiBjdHguc2Vzc2lvbi5wcmljZV8yLFxyXG4gICAgICAgICAgICB0Z1VzZXJuYW1lOiBjdHguZnJvbS51c2VybmFtZSA/IGN0eC5mcm9tLnVzZXJuYW1lIDogbnVsbCxcclxuICAgICAgICAgICAgdGltZU9mV29yazogY3R4LnNlc3Npb24udGltZU9mV29yayxcclxuICAgICAgICAgICAgdGltZVRvQ2FsbDogY3R4LnNlc3Npb24udGltZVRvQ2FsbF8yLFxyXG4gICAgICAgICAgICAvLyBtaW5QcmljZTogY3R4LnNlc3Npb24ubWluUHJpY2UsXHJcbiAgICAgICAgICAgIC8vIG1heFByaWNlOiBjdHguc2Vzc2lvbi5tYXhQcmljZSxcclxuICAgICAgICAgICAgdXNlck1zZ0lkOiBjdHguc2Vzc2lvbi51c2VyTXNnSWQsXHJcbiAgICAgICAgICAgIGFkZGl0aW9uOiBjdHguc2Vzc2lvbi5hZGRpdGlvbiA/IGN0eC5zZXNzaW9uLmFkZGl0aW9uIDogbnVsbCxcclxuICAgICAgICAgICAgaW1nOiBjdHguc2Vzc2lvbi5pbWdcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFjID0gYXdhaXQgRmluZEhyVmFjYW5zeU1vZGVsLmNyZWF0ZShkYXRhKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHZhY0luQWRtaW4gPSBhd2FpdCBib3RfYWRtaW4udGVsZWdyYW0uc2VuZFBob3RvKFxyXG4gICAgICAgIDY1MTk4NTI0NCxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNvdXJjZTogY3R4LnNlc3Npb24uaW1nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNhcHRpb246IGDinIUgTWFsdW1vdGxhcm5pIHRhc2RpcWxhbmdcXG4ke2N0eC5zZXNzaW9uLm1zZ31gLFxyXG4gICAgICAgICAgICBwYXJzZV9tb2RlOiBcIkhUTUxcIixcclxuICAgICAgICAgICAgcmVwbHlfbWFya3VwOiB7XHJcbiAgICAgICAgICAgICAgICBpbmxpbmVfa2V5Ym9hcmQ6IGJ1dHRvbnNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgY3R4LnNlc3Npb24udmFjYW5jeVR5cGUgPT0gJ2ZpbmRXb3JrJ1xyXG4gICAgICAgID8gYXdhaXQgVmFjYW5jeU1vZGVsLnVwZGF0ZU9uZSh7IF9pZDogdmFjLl9pZCB9LCB7IG1lc3NhZ2VJZDogdmFjSW5BZG1pbi5tZXNzYWdlX2lkIH0pXHJcbiAgICAgICAgOiBhd2FpdCBGaW5kSHJWYWNhbnN5TW9kZWwudXBkYXRlT25lKHsgX2lkOiB2YWMuX2lkIH0sIHsgbWVzc2FnZUlkOiB2YWNJbkFkbWluLm1lc3NhZ2VfaWQgfSk7XHJcblxyXG5cclxuICAgIGF3YWl0IGN0eC5yZXBseVdpdGhIVE1MKE1lc3NhZ2VzLlNlbmRUb0FkbWluW2xhbmddKTtcclxuICAgIGF3YWl0IGN0eC5zY2VuZS5lbnRlcihTY2VuZU5hbWVzLk1BSU4pXHJcbn0pXHJcblxyXG5zZW5kVG9BZG1pblNjZW5lLmFjdGlvbigv4p2MLywgYXN5bmMgKGN0eCkgPT4ge1xyXG4gICAgYXdhaXQgY3R4LmVkaXRNZXNzYWdlUmVwbHlNYXJrdXAoeyBpbmxpbmVfa2V5Ym9hcmQ6IFtdIH0pXHJcblxyXG4gICAgY29uc3QgbGFuZyA9IGN0eC5zZXNzaW9uLmxhbmd1YWdlO1xyXG4gICAgYXdhaXQgY3R4LnJlcGx5V2l0aEhUTUwoTWVzc2FnZXMuQ2FuY2VsZWRbbGFuZ10pXHJcbiAgICBhd2FpdCBjdHguc2NlbmUuZW50ZXIoU2NlbmVOYW1lcy5NQUlOKVxyXG59KVxyXG4iXX0=